{"version":3,"sources":["../src/controls.js"],"names":["define","$","Ajax","Log","Templates","Chart","Controls","username","self","prototype","main","trendChart","setupEvents","ctx","document","getElementById","performanceEl","querySelector","performance","JSON","parse","dataset","labels","sets","attendance","effort","grades","TAGS","avgattendance","avgeffort","avggrades","i","p","length","console","year","details","toString","includes","push","label","data","fill","borderColor","tension","type","datasets","options","responsive","maintainAspectRatio","plugins","id","beforeDraw","chart","canvas","getContext","save","globalCompositeOperation","fillStyle","fillRect","width","height","restore","on","getGradeHistory","click","trigger","historyHideCarretHandler","getEffortHistory","effortHideCarretHandler","removeAttr","toggle","call","methodname","args","table","done","response","htmlResult","html","region","attr","replaceWith","fail","reason","error","debug","off","log","init","element","getAttribute","control"],"mappings":"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","sourcesContent":["\n// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package   block_grades_effort_report\n * @copyright 2021 Veronica Bermegui\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'core/ajax', 'core/log', 'core/templates', 'block_grades_effort_report/chart',], function ($, Ajax, Log, Templates, Chart) {\n    'use strict';\n\n    function init() {\n        const element = document.querySelector('.grade-effort-trend');\n        const username = element.getAttribute('data-username');\n\n        var control = new Controls(username);\n        control.main();\n    }\n\n    /**\n    * Controls a single block_grades_effort_report block instance contents.\n    *\n    * @constructor\n    */\n    function Controls(username) {\n        let self = this;\n        self.username = username;\n    }\n\n    /**\n     * Run the controller.\n     *\n     */\n    Controls.prototype.main = function () {\n        let self = this;\n        self.trendChart();\n        self.setupEvents();\n    };\n\n    Controls.prototype.trendChart = function () {\n\n        const ctx = document.getElementById(\"trendChart\");\n        const performanceEl = document.querySelector(\"#performance\");\n        const performance = JSON.parse(performanceEl.dataset.performance);\n\n        let labels = [];\n        let sets = [];\n        let attendance = [];\n        let effort = [];\n        let grades = [];\n\n        const TAGS = {\n            avgattendance: 'Attend Average',\n            avgeffort: 'Effort Average',\n            avggrades: 'Grade Average'\n        }\n\n        for (let i = 0; i < performance.length; i++) {\n            var p = performance[i];\n            console\n            let year = p.details.year.toString();\n\n            if (!labels.includes(year)) {\n                labels.push(year);\n            }\n\n            grades.push(p.details.avggrades);\n            effort.push(p.details.avgeffort)\n            attendance.push(p.details.avgattendance)\n\n        }\n\n        sets.push({\n            label: TAGS.avggrades,\n            data: grades,\n            fill: false,\n            borderColor: '#31326f',\n            tension: 0.1\n        });\n\n        sets.push({\n            label: TAGS.avgeffort,\n            data: effort,\n            fill: false,\n            borderColor: '#ffc93c',\n            tension: 0.1\n        });\n\n        sets.push({\n            label: TAGS.avgattendance,\n            data: attendance,\n            fill: false,\n            borderColor: '#1687a7',\n            tension: 0.1\n        });\n\n        const data = {\n            labels: labels,\n            datasets: sets\n        };\n\n        const options = {\n            responsive: true,\n            maintainAspectRatio: false,\n        }\n\n        const plugin = {\n            id: 'custom_canvas_background_color',\n            beforeDraw: (chart) => {\n                const ctx = chart.canvas.getContext('2d');\n                ctx.save();\n                ctx.globalCompositeOperation = 'destination-over';\n                ctx.fillStyle = '#f6f5f5';\n                ctx.fillRect(0, 0, chart.width, chart.height);\n                ctx.restore();\n            }\n        };\n\n        var myLineChart = new Chart(ctx, {\n            type: 'line',\n            data: data,\n            options: options,\n            plugins: [plugin]\n        });\n\n    };\n\n    Controls.prototype.setupEvents = function () {\n        let self = this;\n\n        $('.grade-history').on('custom.getGradeHistory', function () {\n            self.getGradeHistory();\n        });\n\n        $('.grade-history').click(function () {\n            $(this).trigger(\"custom.getGradeHistory\");\n        });\n\n        $('.grade-history').on('custom.historyHideCarretHandler', function () {\n            self.historyHideCarretHandler();\n        });\n\n        $('.grade-effort').on('custom.getEffortHistory', function () {\n            self.getEffortHistory();\n        });\n\n        $('.grade-effort').click(function () {\n            $(this).trigger(\"custom.getEffortHistory\");\n        });\n\n        $('.grade-effort').on('custom.effortHideCarretHandler', function () {\n            self.effortHideCarretHandler();\n        });\n\n    };\n\n    Controls.prototype.getGradeHistory = function () {\n        let self = this;\n        const username = self.username;\n\n        // Add spinner.\n        $('#grade-history-table').removeAttr('hidden');\n        $('#history-show').toggle(); // Carret down.\n        $('#history-hide').toggle(); // Carret right\n\n        Ajax.call([{\n            methodname: 'block_grades_effort_report_get_context',\n            args: {\n                table: 'grades',\n                username: username\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n                const region = $('[data-region=\"grade-history\"]');\n\n                $('#grade-history-table').attr('hidden', true);\n                region.replaceWith(htmlResult);\n            },\n\n            fail: function (reason) {\n                Log.error('block_grades_effort_report: Unable to get context.');\n                Log.debug(reason);\n                region.replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n        }]);\n\n        $('.grade-history').off('custom.getGradeHistory'); // Remove listener.\n\n        $('.grade-history').on('click', function () {\n            $(this).trigger(\"custom.historyHideCarretHandler\");\n        });\n        \n    };\n\n    Controls.prototype.getEffortHistory = function () {\n\n        let self = this;\n        const username = self.username;\n\n        $('#grade-effort-table').removeAttr('hidden');\n        \n        $('#effort-show').toggle(); // Carret down is displayed\n        $('#effort-hide').toggle(); // Carret right is hidden.\n\n        Ajax.call([{\n            methodname: 'block_grades_effort_report_get_context',\n            args: {\n                table: 'effort',\n                username: username\n            },\n\n            done: function (response) {\n                const htmlResult = response.html;\n                const region = $('[data-region=\"grade-effort\"]');\n\n                $('#grade-effort-table').attr('hidden', true);\n                region.replaceWith(htmlResult);\n                \n            },\n\n            fail: function (reason) {\n                Log.error('block_grades_effort_report: Unable to get context.');\n                Log.debug(reason);\n                region.replaceWith('<p class=\"alert alert-danger\">Data not available. Please try later</p>');\n            }\n            \n        }]);\n\n        $('.grade-effort').off('custom.getEffortHistory') // Remove listener.\n\n        $('.grade-effort').on('click', function () {\n            $(this).trigger(\"custom.effortHideCarretHandler\");\n        });\n\n    };\n\n    Controls.prototype.historyHideCarretHandler = function () {\n\n            $('#history-hide').toggle(); // Carret right. (Table is hidden)\n            $('#history-show').toggle(); // Carret down. (Table is displayed)\n            console.log(\"CLICK historyHideCarretHandler\");\n\n    }\n\n    Controls.prototype.effortHideCarretHandler = function () {\n      \n            $('#effort-hide').toggle(); // Carret right. (Table is hidden)\n            $('#effort-show').toggle(); // Carret down. (Table is displayed)\n            console.log(\"CLICK effortHideCarretHandler\");\n\n    }\n\n    return { init: init }\n});\n"],"file":"controls.min.js"}